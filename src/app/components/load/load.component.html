<section class="load">
  <app-stepper #stepper>
    <app-step [label]="'Select File'" icon="upload">
      <app-dropzone (onFilePath)="next($event)"></app-dropzone>
    </app-step>
    <app-step [label]="'Choose Entity'" icon="candidate">
      <div class="choose-entity-container">
        <span class="main-text">Choose type of entity records to load</span>
        <span class="sub-text" *ngIf="!entity">Select from one of the currently supported entities</span>
        <span class="sub-text" *ngIf="entity">The entity has been preselected based on the file name, but you can still change it</span>
        <div class="choose-entity-picker">
          <i *ngIf="icon" class="entity-icon {{icon}} {{theme}}"></i>
          <novo-picker [config]="entityPickerConfig"
                       placeholder="Choose Bullhorn Entity"
                       [(ngModel)]="entity"></novo-picker>
          <button theme="primary"
                  [disabled]="!entity"
                  (click)="next()"
                  icon="next">Next
          </button>
        </div>
      </div>
    </app-step>
    <app-step [label]="'Map Columns'" icon="list">
      <div class="table-container" *ngIf="meta">
        <span class="main-text">Map columns from file to fields in Bullhorn</span>
        <span class="sub-text">Loading <strong>{{ numSelectedRows }} of {{ rows?.length }}</strong>
          columns for {{ totalRows }} records</span>
        <novo-data-table *ngIf="rows" [rows]="rows" [columns]="columns" [displayedColumns]="displayedColumns" #table>
          <ng-template novoTemplate="fieldCell" let-row>
            <novo-picker [config]="fieldPickerConfig"
                         (select)="onFieldMappingChanged($event, row)"
                         [(ngModel)]="row.field"
                         placeholder="Choose Field"></novo-picker>
          </ng-template>
          <ng-template novoTemplate="subfieldCell" let-row>
            <novo-picker *ngIf="row.fieldMeta?.associatedEntity"
                         [config]="fieldPickerConfig"
                         (select)="onSubfieldMappingChanged($event, row.subfield)"
                         [(ngModel)]="row.subfield"
                         placeholder="Choose Subfield"></novo-picker>
          </ng-template>
        </novo-data-table>
      </div>
      <div class="loading-container" *ngIf="!meta">
        <span class="main-text">Getting latest {{ entity }} field map settings...</span>
        <novo-loading></novo-loading>
      </div>
    </app-step>
    <app-step [label]="'Duplicate Check'" icon="duplicate">
      <div class="duplicate-check-container">
        <span class="main-text">Update existing records using duplicate check</span>
        <span class="sub-text">Choose a field or combination of fields to match with
          existing records for updates instead of inserts</span>
        <div *ngIf="duplicateCheckFieldsPickerConfig.options?.length" class="form-container">
          <novo-tiles [options]="duplicateCheckEnabledTileOptions"
                      (onChange)="onDuplicateCheckEnabledChanged($event)"
                      [(ngModel)]="existField.enabled"></novo-tiles>
          <novo-chips *ngIf="existField.enabled"
                      [source]="duplicateCheckFieldsPickerConfig"
                      [(ngModel)]="duplicateCheckModel"></novo-chips>
          <span *ngIf="existField.enabled && existField.fields?.length > 1" class="sub-text tip">
            All fields must match for an existing record to be considered a match</span>
        </div>
      </div>
    </app-step>
  </app-stepper>
  <footer>
    <div class="left-hand-side">
      <button *ngIf="stepper.selectedIndex"
              theme="standard"
              (click)="previous()">Back
      </button>
    </div>
    <div class="right-hand-side">
      <button *ngIf="stepper.selectedIndex === stepEnum.MapColumns"
              theme="primary"
              [disabled]="!numSelectedRows"
              (click)="next()"
              icon="next">Next
      </button>
      <novo-checkbox *ngIf="duplicateCheckFieldsPickerConfig.options?.length && existField.enabled && existField.fields?.length"
                     [(ngModel)]="backupEnabled"
                     label="Generate Undo File"
                     tooltipPosition="top-left"
                     tooltip="Generates a backup file for reverting mass updates to existing records to undo any changes made">
      </novo-checkbox>
      <button *ngIf="stepper.selectedIndex === stepEnum.DuplicateCheck"
              theme="primary"
              class="load-button"
              [disabled]="!run?.previewData"
              (click)="next()"
              icon="upload"
              tooltip="Start uploading data into Bullhorn"
              tooltipPosition="top-left">Load
      </button>
    </div>
  </footer>
</section>
