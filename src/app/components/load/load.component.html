<section class="load">
  <app-stepper #stepper>
    <app-step [label]="'Select File'" icon="upload">
      <app-dropzone selector="app-dropzone" (onFilePath)="onFileSelected($event)"></app-dropzone>
    </app-step>
    <app-step [label]="'Choose Entity'" icon="candidate">
      <div class="choose-entity-container">
        <span class="main-text">Choose the type of entity records this file contains</span>
        <span class="sub-text" *ngIf="!entity">Select from one of the currently supported entities</span>
        <span class="sub-text" *ngIf="entity">The entity has been preselected based on the file name,
          but you can still change it</span>
        <div class="choose-entity-picker">
          <novo-picker [config]="entityPickerConfig" placeholder="Choose Entity" [(ngModel)]="entity"></novo-picker>
          <button theme="primary" [disabled]="!entity" (click)="onEntitySelected()">Next</button>
        </div>
      </div>
    </app-step>
    <app-step [label]="'Map Columns'" icon="list">
      <div class="table-container" *ngIf="meta">
        <span class="main-text">Map columns from file to fields in Bullhorn</span>
        <span class="sub-text">Mapping <strong>{{ rows?.length }} of {{ rows?.length }}</strong>
          columns for {{ run.previewData?.total }} records.</span>
        <novo-data-table [rows]="rows" [columns]="columns" [displayedColumns]="displayedColumns" #table>
          <ng-template novoTemplate="fieldCell" let-row let-col="col">
            <novo-picker [config]="fieldPickerConfig" placeholder="Choose Field"></novo-picker>
          </ng-template>
          <ng-template novoTemplate="subfieldCell" let-row let-col="col">
            <novo-picker [config]="fieldPickerConfig" placeholder="Choose Subfield"></novo-picker>
          </ng-template>
        </novo-data-table>
      </div>
      <div class="loading-container" *ngIf="!meta">
        <span class="main-text">Getting latest {{ entity }} field map settings...</span>
        <novo-loading></novo-loading>
      </div>
    </app-step>
    <app-step [label]="'Duplicate Check'" icon="duplicate">
      <div class="duplicate-check-container">
        <span class="main-text">Choose whether to check for duplicates</span>
        <span class="sub-text">Use a field or combination of fields to match new records with
          existing records for records updates instead of record inserts</span>
        <novo-dynamic-form *ngIf="duplicateCheckForm"
                           [fieldsets]="duplicateCheckFieldSets"
                           [(form)]="duplicateCheckForm"></novo-dynamic-form>
      </div>
    </app-step>
  </app-stepper>
  <footer [ngClass]="{'one-button': stepper.selectedIndex < 2, 'two-buttons': stepper.selectedIndex >= 2}">
    <button *ngIf="stepper.selectedIndex > 0" theme="standard" (click)="stepper.previous()">Back</button>
    <button *ngIf="stepper.selectedIndex === 2" theme="primary" [disabled]="!entity" (click)="onColumnsMapped()">Next</button>
    <button *ngIf="stepper.selectedIndex === 3" theme="primary" class="load-button" [disabled]="!run?.previewData" (click)="onLoad()"
            icon="upload" tooltip="Start uploading data into Bullhorn" tooltipPosition="top-left">Load
    </button>
  </footer>
</section>
